# Services

## Objectives

* Describe and Compare Services and Factories in Angular.js
* Describe a Singleton and ennumerate use cases for Singletons
* Create a custom Service or Factory to use in an Angular app
* Use an Angular Service to manage data accross controllers

## A brief introduction

As we start building larger applications with multiple controllers, not only is our code per controller becoming larger, but we are starting to face with a new problem. How do we share data, properties and methods between controllers? Our first thought might be to use `$rootScope` and pass it to each of our controllers, but this gets messy quickly. It would be really nice to have to tool to do this - and for that we use services!

### So many choices:

When you start learning about services you will see many different things around creating a `service`, `factory`, or `provider`. These are all commonly called services and one of them is called service...it's a bit tricky, but for the most part these three things serve very similar purposes and they are only a bit different. We will compare and contrast these later, but for now, let's learn a little more about how services work in Angular:

Angular services are components that are added to your code via dependency injection.  From the[ angular docs](https://docs.angularjs.org/guide/services):


> Angular services are:
>
> * Lazily instantiated – Angular only instantiates a service when an application component depends on it.
> * Singletons – Each component dependent on a service gets a reference to the single instance generated by the service factory. 

That first bullet point may be a bit easier to digest (no pun intended), but what is a singleton? From Wikipedia "In software engineering, the singleton pattern is a design pattern that restricts the instantiation of a class to one object." You can read some more about it [here](http://addyosmani.com/resources/essentialjsdesignpatterns/book/#singletonpatternjavascript), [here](http://robdodson.me/javascript-design-patterns-singleton/) and [here](https://en.wikipedia.org/wiki/Singleton_pattern).

**EXERCISE 1: Singletons**

Use the singleton pattern in plain javascript to create an object that stores a list of instructors.  Add Tim, Elie, Matt, and Ian to the list.  Get a second instance of the singleton and verify that the four instructors are still in the list.


### The "service" service and the "factory" service

The end result of a factory and service is the same: a singleton instance that can be used throughout your application.

The main difference between a factory and a service comes down to how they are defined.

Using the factory API, you pass in a function that returns an object.

Behind the scenes, Angular calls the function and sets the returned object as the singleton instance that will be injected into your controllers.

```js
angular
  .module("learnServices", [])
  .factory('personFactory', function(){
    return {
      name: "Matt",
      job: "Instructor",
      sayHi: function(){
        return "Hello!"
      }
    }
  }).controller('personController', function(personFactory){
    // I now have access to all the methods/properties returned from the personFactory!
  })
```

Using the service API, you create a constructor function using the `this` syntax to attach properties/methods to the constructor.

Behind the scenes, Angular calls `new` on your function to create an instance. This instance is set as the singleton instance that will be injected into your controllers.

Here is the same service defined using the service API:

```js
angular
  .module("learnServices", [])
  .service('personService', function(){
    this.name = "Matt";
    this.job = "Instructor";
    this.sayHi = function(){
      return "Hello!"
    }
  }).controller('personController', function(personService){
    // I now have access to the personService!
  });
```

A provider is the most complex method and is used less frequently. It is a factory that can be configured before the application starts, which allows for more flexibility, but for the applications we are going to build, you will not need this level of complexity.

### So which one??

Many articles will lean towards factories, but with the new ES2015 syntax, services are becoming more preferable. Be aware of both of these and the differences between them. 

To read more about the differences and why some choose factories over services and vise versa - check out these articles:

[ng-newsletter: The short guide to service definitions](http://www.ng-newsletter.com/25-days-of-angular/day-1)

[Service VS Factory - ONCE AND FOR ALL](http://blog.thoughtram.io/angular/2015/07/07/service-vs-factory-once-and-for-all.html)

[AngularJS: Factory vs Service vs Provider](http://tylermcginnis.com/angularjs-factory-vs-service-vs-provider/)

[AngularJS Providers Explained](https://gist.github.com/demisx/9605099)

### An extra Angular goodie - Constants

An additional feature of angular that is worth knowing about is constants. Sometimes you will want to use variables across your application that will never change. To do this, you can use constants. These will usually live in a `constants.js` file inside your `js` folder. To create a constant, simply write (assuming we have this "sampleApp" defined somewhere else):

`angular.module("sampleApp").constant('CONSTANT_NAME', 'CONSTANT_VALUE')`

These values should **NEVER** be changed!

### Creating our first Service

#### **Note: a factory is a type of service. You will commonly see factories refered to as services**

To create a service, let's make sure we are using our new layout and have a `services.js` file. The syntax to create a service looks like this:

```js
angular
  .module("learningServices")
  .factory("firstService", function() {
    // outside of the return block, we can declare private variables and functions

    // we must return an object, everything we return can be accessed externally
    return {
      sayHi: function() {
        return "Hello!"
      },
      sayGoodbye: function() {
        return "Goodbye!"
      },
      getAllUsers: function() {
        // some AJAX call to our database to get all the users
      },
      addUser: function(user) {
        // another AJAX call to our database to add a user
      }
    }
  });
```

Now in our controller, we can inject this service:

```js
angular
  .module("learningServices")
  .controller("FirstController", function($scope, firstService) {
    $scope.view = {};
    $scope.view.greeting = firstService.sayHi(); 
    $scope.view.users = firstService.getAllUsers();
  });
```

### Answer the following questions:

- What is a service? What problem do they solve for us?
- What is a singleton? Why would we use them?
- What is the difference between a factory, service and provider?
- Name at least 3 angular built in services that we have used so far.

**EXERCISE 2: mathService**

For this exercise you will be building a simple application which contains a form where a user can select an operation (add, subtract, multiply, divide and power) and two numbers and when the form is submitted, the value expression is returned.

All of your calculation logic for the operations should be contained in a service - your controller should have a **very** minimal amount of code.

You should be using the new folder structure and angular router for this application. Although you only need one route, it's good practice!

It should function like (and look far better than) this:

[![https://gyazo.com/9f2e41f9a7d5124763fac27f44ce3c86](https://i.gyazo.com/9f2e41f9a7d5124763fac27f44ce3c86.gif)](https://gyazo.com/9f2e41f9a7d5124763fac27f44ce3c86)

**EXERCISE 3: todoService**

For this exercise you will be building a todo app will full CRUD (no backend required). It should have the following requirements

- a user should be able to create a todo only when there is text present (use angular form validation!)
- a user should see all of their created todos with the option to delete a single todo
- a user should be able to edit each individual todo. This involves showing/hiding a new form for editing the text of a todo

All of your logic to create, show, updated and delete todos should be inside of a **service**. 

You should be using the new folder structure and angular router for this application. Although you only need one route, it's good practice!

It should function like (and look far better than) this:

[![https://gyazo.com/ac2169731726c391acfd87cf50137e58](https://i.gyazo.com/ac2169731726c391acfd87cf50137e58.gif)](https://gyazo.com/ac2169731726c391acfd87cf50137e58)

**EXERCISE 4: refactoring our contacts app**

Revisit your contacts app from previous lessons. In contact app, add the following code to a new service inside `service.js`:

```js
angular
  .module("learningServices")
  .factory('ContactList', function() {
    var ContactList = {};

    ContactList.contactList = [];

    ContactList.addContact = function(obj) {
      ContactList.contactList.push(obj);
    };

    ContactList.findContact = function(name) {
      // TODO
    };

    ContactList.removeContact = function(index) {
      // TODO
    };

    return ContactList;
  });
```

Now in your controller you can inject the contact service you created as a dependency.  For example, your controller might look like this:

```js
angular
  .module("learningServices")
  .controller('ContactController', function($scope, ContactList) {
    $scope.view = {};
    $scope.view.contactData = ContactList.contactList;
    // TODO: Your ContactList controller code here.
  });
```

- Refactor your contacts app to use a ContactList service.  Remember to stick with best practices and use the inline array annotation.

- Add a show page to your contacts app. This will require a separate controller but you can use the same ContactList service and share it between controllers. The "id" for the show page should by the index of contact in the contactList.

**EXERCISE 5**

Use the [Giphy Api](https://github.com/Giphy/GiphyAPI) to add a feature to to the contacts application.  Whenever a new user is submitted, do a search for a gif using the person's name.  If you get a result, save that along with the users name email and phone number.  Show the user's gif on the show page.  HINT: you will NOT want to use the embedded url from the giphy search resutls.

# Resources

[Putting Angular Code in the Right Place](http://datamelon.io/blog/2016/putting-angular-code-in-the-right-place.html)
